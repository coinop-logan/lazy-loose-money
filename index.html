<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.9.1/css/tachyons.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/web3@0.20.5/dist/web3.min.js"></script>
    <!-- <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script> -->
</head>

<body class="black-80">
    <main id="app" class="flex flex-column items-center">
        <div class="mw7 w-100 ph3 ph4-ns">
            <header>
                <p>Your account {{ address }} has {{ value }} ether(s).</p>
            </head>
            <div class="mw7 w-100 f5 f4-ns fw3 lh-copy mb0">
            </div>
        </div>
      </main>
</body>

<script>

var app = new Vue({
  el: '#app',
  data: {
    address: '0x0',
    value: 0,
  }
})

// https://codepen.io/k3no/pen/MEzvrV
window.addEventListener("load", function() {
    // Checking if Web3 has been injected by the browser (Mist/MetaMask)
    if (typeof web3 !== "undefined") {
      // Use Mist/MetaMask's provider
      window.web3 = new Web3(web3.currentProvider);
    } else {
      console.log("No web3? You should consider trying MetaMask!");
      // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
      window.web3 = new Web3(
        new Web3.providers.HttpProvider("http://localhost:8545")
      );
    }

    web3.eth.getAccounts(function(error, accounts) {
        if (!error) {
            web3.eth.getBalance(accounts[0], function(error, balance) {
                if (!error) {
                    app.address = accounts[0];
                    app.value = balance.toNumber() / web3.toWei(1, 'ether');
                } else {
                    console.error(error);
                }
            });
        } else {
            console.error(error);
        }
    });

    window.llmFactory = web3.eth.contract(LlmFactoryAbi).at(LlmFactoryContractAddress);
    window.commimentContract = web3.eth.contract(CommitmentAbi);

    llmFactory.getCurrentCommitment(function(err, res) {
        if (err) {
            console.log(err.message);
        } else {
            console.log(res);
            window.currentCommitment = commimentContract.at(res);

            currentCommitment.getInfo(function (err, res) {
                if (err) {
                    console.log(err.message);
                } else {
                    console.log(res);
                }
            });

            currentCommitment.cancel(function (err, res) {
                if (err) {
                    console.log(err.message);
                } else {
                    console.log(res);
                }
            });

            // valueInEth = 0.01;
            // llmFactory.createCommitment('do it now', 1, {'value': web3.toWei(valueInEth, 'ether')}, function(err, res) {
            //     if (err) {
            //         console.log(err.message);
            //     } else {
            //         console.log(res);
            //     }
            // });
        } // getCurrentCommitment
    });



    llmFactory.commitments(0, function(err, res) {
        if (err) {
            console.log(err.message);
        } else {
            console.log(res);
        }
    });
});

var LlmFactoryContractAddress = '0x19F26aAdE06414889a09ba59aa0b386630c1AfDE';

/* run `solc --abi contracts/LazyLooseMoney.sol` to get the ABI jsons */
// ======= contracts/LazyLooseMoney.sol:Commitment =======
var CommitmentAbi = [{"constant":false,"inputs":[{"name":"encouragement","type":"string"}],"name":"supportFund","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[],"name":"commit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"cancel","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"guardian","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"title","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getInfo","outputs":[{"name":"","type":"address"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint8"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"release","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"beGuardian","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"completed","type":"bool"}],"name":"report","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"supportersFunded","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_creator","type":"address"},{"name":"_title","type":"string"},{"name":"_days","type":"uint256"}],"payable":true,"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commitment","type":"address"},{"indexed":true,"name":"owner","type":"address"},{"indexed":false,"name":"deposit","type":"uint256"},{"indexed":false,"name":"title","type":"string"},{"indexed":false,"name":"createdAt","type":"uint256"},{"indexed":false,"name":"daysCount","type":"uint256"}],"name":"Created","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commitment","type":"address"},{"indexed":true,"name":"supporter","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"encouragement","type":"string"}],"name":"fundAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commitment","type":"address"},{"indexed":true,"name":"owner","type":"address"},{"indexed":false,"name":"startedAt","type":"uint256"},{"indexed":false,"name":"finishedAt","type":"uint256"}],"name":"Started","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commitment","type":"address"},{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"guardian","type":"address"},{"indexed":false,"name":"guardianDeposit","type":"uint256"},{"indexed":false,"name":"guardedAt","type":"uint256"}],"name":"Guarded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commitment","type":"address"},{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"guardian","type":"address"},{"indexed":false,"name":"completed","type":"bool"},{"indexed":false,"name":"reportedAt","type":"uint256"}],"name":"Reported","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commitment","type":"address"},{"indexed":true,"name":"owner","type":"address"},{"indexed":false,"name":"dayscount","type":"uint256"},{"indexed":false,"name":"reportedDays","type":"uint256"},{"indexed":false,"name":"completedDays","type":"uint256"},{"indexed":false,"name":"ownerReward","type":"uint256"},{"indexed":false,"name":"guardianReward","type":"uint256"},{"indexed":false,"name":"closedAt","type":"uint256"}],"name":"Closed","type":"event"}]

// ======= contracts/LazyLooseMoney.sol:LlmFactory =======
var LlmFactoryAbi = [{"constant":false,"inputs":[{"name":"_title","type":"string"},{"name":"_days","type":"uint256"}],"name":"createCommitment","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"commitments","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCurrentCommitment","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getLastCommitmentAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":false,"name":"commitment","type":"address"},{"indexed":false,"name":"title","type":"string"},{"indexed":false,"name":"daysCount","type":"uint256"}],"name":"CommitmentCreated","type":"event"}]

</script>
</html>
